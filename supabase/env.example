# Local Supabase (CLI) environment file.
# Copy this file to `supabase/.env` (this path is ignored by git) and fill the values.
#
# You can get SUPABASE_URL / ANON / SERVICE_ROLE from `supabase status`.
#
# Tip: you can start Supabase local while auto-loading `supabase/.env` with:
#   ./scripts/supabase_local.sh start
#
# Recommended:
# - Put WhatsApp secrets in `supabase/.env.local` (see `supabase/env.local.template`).

# --- Edge Functions runtime ---
SUPABASE_URL=http://127.0.0.1:54321
SUPABASE_ANON_KEY=__set_from_supabase_status__
SUPABASE_SERVICE_ROLE_KEY=__set_from_supabase_status__

# LLM
GEMINI_API_KEY=__your_gemini_key__
# Optional: default model overrides (if unset, code falls back to sane defaults).
# - GEMINI_SOPHIA_CHAT_MODEL: used for investigator/companion/architect (router-enforced).
# - GEMINI_JUDGE_MODEL: used by eval-judge when request doesn't override the model.
GEMINI_SOPHIA_CHAT_MODEL=gemini-3-flash-preview
GEMINI_JUDGE_MODEL=gemini-3-pro-preview
# Optional: fallback model used when the primary model is overloaded (429/503) after several retries.
# Leave empty to disable model fallback.
GEMINI_FALLBACK_MODEL=

# Internal call auth for service-role Edge Functions (cron + db triggers)
INTERNAL_FUNCTION_SECRET=__set_a_long_random_string__

# Stripe (billing)
# - STRIPE_SECRET_KEY: starts with sk_
# - STRIPE_WEBHOOK_SECRET: starts with whsec_
# - STRIPE_PRICE_ID_*: starts with price_
# - APP_BASE_URL: where Stripe redirects after Checkout/Portal (ex: http://localhost:5173)
STRIPE_SECRET_KEY=__your_stripe_secret_key__
STRIPE_WEBHOOK_SECRET=__your_stripe_webhook_secret__
#
# 3 tiers x 2 intervals (monthly/yearly)
STRIPE_PRICE_ID_SYSTEM_MONTHLY=__your_system_monthly_price_id__
STRIPE_PRICE_ID_SYSTEM_YEARLY=__your_system_yearly_price_id__
STRIPE_PRICE_ID_ALLIANCE_MONTHLY=__your_alliance_monthly_price_id__
STRIPE_PRICE_ID_ALLIANCE_YEARLY=__your_alliance_yearly_price_id__
STRIPE_PRICE_ID_ARCHITECTE_MONTHLY=__your_architecte_monthly_price_id__
STRIPE_PRICE_ID_ARCHITECTE_YEARLY=__your_architecte_yearly_price_id__
APP_BASE_URL=http://localhost:5173

# WhatsApp Cloud API (Meta)
WHATSAPP_ACCESS_TOKEN=__your_whatsapp_cloud_api_access_token__
WHATSAPP_PHONE_NUMBER_ID=__your_phone_number_id__
WHATSAPP_APP_SECRET=__your_meta_app_secret__
WHATSAPP_WEBHOOK_VERIFY_TOKEN=__set_a_random_verify_token__
WHATSAPP_OPTIN_TEMPLATE_NAME=sophia_optin_v1
WHATSAPP_OPTIN_TEMPLATE_LANG=fr
WHATSAPP_BILAN_TEMPLATE_NAME=sophia_bilan_v1
WHATSAPP_BILAN_TEMPLATE_LANG=fr
WHATSAPP_CHECKIN_TEMPLATE_NAME=sophia_checkin_v1
WHATSAPP_CHECKIN_TEMPLATE_LANG=fr
WHATSAPP_MEMORY_ECHO_TEMPLATE_NAME=sophia_memory_echo_v1
WHATSAPP_MEMORY_ECHO_TEMPLATE_LANG=fr

# Batch throttling (recommended once you have many users)
# - DAILY_BILAN_THROTTLE_MS: delay between each outbound user send in trigger-daily-bilan
# - DAILY_BILAN_MAX_SEND_ATTEMPTS: retry attempts per user when WhatsApp/Graph returns 429
DAILY_BILAN_THROTTLE_MS=300
DAILY_BILAN_MAX_SEND_ATTEMPTS=5

# Daily bilan copy (optional)
# - DAILY_BILAN_USE_AI: if true, generate a personalized intro using Gemini + recent WhatsApp context.
# - DAILY_BILAN_MODEL: Gemini model used for the bilan copy.
# - DAILY_BILAN_CONTEXT_MESSAGES: number of recent WhatsApp chat_messages to include as context (0-12).
DAILY_BILAN_USE_AI=true
DAILY_BILAN_MODEL=gemini-2.5-flash
DAILY_BILAN_CONTEXT_MESSAGES=6

# --- Vault (DB) ---
# Used by Supabase Vault locally to encrypt/decrypt secrets.
SUPABASE_VAULT_SECRET_KEY=__set_a_long_random_string__

# --- Optional (Edge runtime secrets envelope) ---
SUPABASE_EDGE_SECRETS_KEY=__set_a_long_random_string__


